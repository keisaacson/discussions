<h2><%= @discussion.title %> Leader Page</h2>

<p>Leader Code: <%= @discussion.leader_code %></p>
<p>Participant Code: <%= @discussion.participant_code %></p>

<p class="message-container"></p>

<%= form_tag("/discussions/#{@discussion.id}/surveys", method: :post, remote: true) do -%>
	<div>
		<label for="question"> Survey Question </label>
		<input type="text" id="question" name="survey[survey_question]">

		<input type="hidden" name="survey[discussion_id]" value=<%="#{@discussion.id}"%>>
	</br>
		<input type="submit" name="survey[survey_action]" value="Create Survey For Later">
		<input type="submit" name="survey[survey_action]" value="Create &amp; Send Survey">
	</div>
<% end -%>

<% surveys = @discussion.surveys.group_by {|s| s.survey_status} %>

<div class="surveys-container">
	<p>Open Surveys</p>
	<%= render('discussions/survey_list', {:surveys => surveys, :status => 'open'}) %>

	<p>Closed Surveys</p>
	<%= render('discussions/survey_list', {:surveys => surveys, :status => 'closed'}) %>

	<p>Ended Surveys</p>
	<%= render('discussions/survey_list', {:surveys => surveys, :status => 'ended'}) %>
</div>

<div class="survey-responses-container">
	<p>Survey Responses</p>
	<ul class="ended-survey-responses-list">
		<% if surveys['ended'] %>
			<% surveys['ended'].each do |s| %>
				<%= render('survey_responses/responses_list', {:s => s}) %>
			<% end %>
		<% end %>
	</ul>
	<button class="hide-results-button" hidden>Hide Results</button>
</div>

<div class="participant-questions-container">
	<p>New Participant Questions</p>
	<ul class="questions-list">
		<% if @discussion.questions.length > 0 %>
			<% @discussion.questions.each do |q| %>
				<% if q.question_status == "unanswered" %>
					<%= render('questions/question_response_form', {:q => q}) %>
				<% end %>	
			<% end %>	
		<% end %>
	</ul>
</div>

<div class="answered-questions-container">
	<p>Old Participant Questions</p>
	<ul class="old-questions-list">
		<% if @discussion.questions.length > 0 %>
			<% @discussion.questions.each do |q| %>
				<% if q.question_status == "answered" %>
					<span id=<%="question#{q.id}-answered-span"%>>
						<li><%= q.content %></li>
						<p><%= q.response %></p>
					</span>
				<% end %>	
			<% end %>	
		<% end %>
	</ul>
</div>


<%= link_to 'Show Participant Page', discussion_path(@discussion.id) %></br>
<%= link_to 'All Discussions', discussions_path %>

<script>
	var channel = dispatcher.subscribe('questions');
	channel.bind('add_new_question', function(data) {
	    $('ul.questions-list').append('<span id="question' + data['id'] + '-response-span"><li>' + data['content'] + '</li><button class="respond-to-question-button">Respond</button><form accept-charset="UTF-8" action="/questions/' + data['id'] + '" data-remote="true" method="post" id: "response-question' + data['id'] + '" hidden><div style="display:none"><input name="utf8" type="hidden" value="✓"><input name=​"_method" type=​"hidden" value=​"put">​</div><textarea rows="3" cols="25" name="question[response]"></textarea><input type="hidden" name="question[question_status]" value="answered"><input type="submit" value="Save Response"></form></span>');
	    $('.respond-to-question-button').on('click', function(e) {
			$(e.target).next('form').show();
			$(e.target).hide();
		});
	});
</script>


<!-- <section>
	<div id="accordion">
		<% if @discussion.questions.length > 0 %>
			<% @discussion.questions.each do |q| %>
				<h3><%= q.content %></h3>
				<div>
					<textarea rows="5" cols="30"></textarea>
				</div>
			<% end %>	
		<% end %>
	</div>
</section>

<script>
	$(document).on('ready', function() {
		$("#accordion").accordion({ active: false, collapsible: true });
	});
	var channel = dispatcher.subscribe('new_question');
	channel.bind('add_new_question', function(data) {
	  $('div#accordion').append('<h3>'+data['content']+'</h3><div><textarea rows="10" cols="50"></textarea></div>');
	  $("#accordion").accordion({ active: false, collapsible: true });
	});
</script> -->